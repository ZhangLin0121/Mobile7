# E-Mobile 7 è‡ªåŠ¨æ‰“å¡ç³»ç»Ÿ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æç®€é«˜æ•ˆçš„ E-Mobile 7 è‡ªåŠ¨æ‰“å¡æœåŠ¡ï¼Œæ”¯æŒå¤šç”¨æˆ·ã€å®šæ—¶æ‰“å¡ã€ç®€æ´é…ç½®ã€‚

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- âœ… **å¤šç”¨æˆ·æ”¯æŒ** - ä¸€ä¸ªæœåŠ¡ç®¡ç†å¤šä¸ªç”¨æˆ·è´¦å·
- âœ… **å·¥ä½œæ—¥æ‰“å¡** - è‡ªåŠ¨è¯†åˆ«å·¥ä½œæ—¥è¿›è¡Œä¸Šä¸‹ç­æ‰“å¡
- âœ… **ç®€æ´é…ç½®** - åªéœ€é…ç½®åŸºæœ¬ä¿¡æ¯å³å¯è¿è¡Œ
- âœ… **è‡ªåŠ¨é‡è¿** - è®¤è¯å¤±è´¥è‡ªåŠ¨é‡æ–°ç™»å½•
- âœ… **systemdæœåŠ¡** - å¼€æœºè‡ªå¯åŠ¨ï¼Œæ•…éšœè‡ªåŠ¨é‡å¯
- âœ… **æ‰“å¡è®°å½•** - è®°å½•æ‰€æœ‰æ‰“å¡ç»“æœï¼Œæ–¹ä¾¿æŸ¥è¯¢

## ğŸ“ é¡¹ç›®ç»“æ„

```
E-Mobile 7/
â”œâ”€â”€ checkin_service.py    # ä¸»æ‰“å¡æœåŠ¡ç¨‹åº (307è¡Œ)
â”œâ”€â”€ config.yaml          # é…ç½®æ–‡ä»¶
â”œâ”€â”€ checkin.service       # systemdæœåŠ¡é…ç½®
â”œâ”€â”€ requirements.txt      # Pythonä¾èµ–
â”œâ”€â”€ README.md            # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ punch_records.json   # æ‰“å¡è®°å½•
â””â”€â”€ checkin.log          # è¿è¡Œæ—¥å¿—
```

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### 1. ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨

```bash
# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp checkin_service.py checkin.service requirements.txt root@47.122.68.192:/opt/emobile-checkin/
```

### 2. å®‰è£…ä¾èµ–

```bash
ssh root@47.122.68.192
cd /opt/emobile-checkin
pip3 install -r requirements.txt
```

### 3. é…ç½®æœåŠ¡

```bash
# å¤åˆ¶æœåŠ¡æ–‡ä»¶
cp checkin.service /etc/systemd/system/
systemctl daemon-reload
systemctl enable checkin
systemctl start checkin
```

## âš™ï¸ é…ç½®æ–‡ä»¶è¯´æ˜

### config.yaml ç¤ºä¾‹

```yaml
server:
  base_url: http://223.76.229.248:11032
  auth_url: http://223.76.229.248:8999

users:
  - username: è¯·ä¿®æ”¹ä¸ºä½ çš„ç”¨æˆ·å
    password: è¯·ä¿®æ”¹ä¸ºä½ çš„å¯†ç 
    display_name: è¯·ä¿®æ”¹ä¸ºæ˜¾ç¤ºåç§°
    enabled: true
    location:
      latitude: '30.487572428385416'
      longitude: '114.50522216796875'
      position: ä¸­å›½æ­¦æ±‰å¸‚æ´ªå±±åŒºé«˜æ–°å¤§é“772å·æ­¦æ±‰ä¸œæ¹–æ–°æŠ€æœ¯å¼€å‘åŒº
  
  # æ·»åŠ æ›´å¤šç”¨æˆ·
  # - username: user2
  #   password: password2
  #   display_name: ç”¨æˆ·2
  #   enabled: true
  #   location:
  #     latitude: '30.487572428385416'
  #     longitude: '114.50522216796875'
  #     position: ä¸­å›½æ­¦æ±‰å¸‚æ´ªå±±åŒºé«˜æ–°å¤§é“772å·æ­¦æ±‰ä¸œæ¹–æ–°æŠ€æœ¯å¼€å‘åŒº

schedule:
  morning:
    start: '06:00'    # ä¸Šç­æ‰“å¡å¼€å§‹æ—¶é—´
    end: '07:00'      # ä¸Šç­æ‰“å¡ç»“æŸæ—¶é—´
  evening:
    start: '17:30'    # ä¸‹ç­æ‰“å¡å¼€å§‹æ—¶é—´
    end: '18:00'      # ä¸‹ç­æ‰“å¡ç»“æŸæ—¶é—´
```

### ç”¨æˆ·é…ç½®è¯´æ˜

- `username`: E-Mobileç™»å½•ç”¨æˆ·å
- `password`: E-Mobileç™»å½•å¯†ç 
- `display_name`: æ˜¾ç¤ºåç§°ï¼ˆç”¨äºæ—¥å¿—ï¼‰
- `enabled`: æ˜¯å¦å¯ç”¨è¯¥ç”¨æˆ·ï¼ˆtrue/falseï¼‰
- `location`: æ‰“å¡åœ°ç†ä½ç½®ä¿¡æ¯

## ğŸ“Š ä½¿ç”¨æ–¹æ³•

### æµ‹è¯•æ‰“å¡

```bash
# æµ‹è¯•ä¸‹ç­æ‰“å¡
python3 checkin_service.py --test --type off

# æµ‹è¯•ä¸Šç­æ‰“å¡
python3 checkin_service.py --test --type on

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶æµ‹è¯•
python3 checkin_service.py --config my_config.yaml --test
```

### è¿è¡ŒæœåŠ¡

```bash
# ç›´æ¥è¿è¡Œ
python3 checkin_service.py

# ä½¿ç”¨systemdç®¡ç†
systemctl start checkin
systemctl status checkin
systemctl stop checkin
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
journalctl -u checkin -f

# æŸ¥çœ‹ç¨‹åºæ—¥å¿—
tail -f /opt/emobile-checkin/checkin.log

# æŸ¥çœ‹æ‰“å¡è®°å½•
cat /opt/emobile-checkin/punch_records.json
```

## ğŸ•’ æ‰“å¡æ—¶é—´

- **ä¸Šç­æ‰“å¡**: å‘¨ä¸€è‡³å‘¨äº” 06:00-07:00 éšæœºæ—¶é—´
- **ä¸‹ç­æ‰“å¡**: å‘¨ä¸€è‡³å‘¨äº” 17:30-18:00 éšæœºæ—¶é—´
- **å‘¨æœ«**: è‡ªåŠ¨è·³è¿‡

### æ—¶é—´åŒºé—´é…ç½®

ç³»ç»Ÿä¼šåœ¨æŒ‡å®šæ—¶é—´åŒºé—´å†…**éšæœºé€‰æ‹©æ‰“å¡æ—¶é—´**ï¼Œé¿å…å›ºå®šæ—¶é—´è¢«æ£€æµ‹ï¼š

```yaml
schedule:
  morning:
    start: '06:00'    # æœ€æ—© 6:00
    end: '07:00'      # æœ€æ™š 7:00
  evening:
    start: '17:30'    # æœ€æ—© 17:30
    end: '18:00'      # æœ€æ™š 18:00
```

æ¯æ¬¡å¯åŠ¨æœåŠ¡æ—¶ï¼Œä¼šä¸ºæ¯å¤©ç”Ÿæˆä¸åŒçš„éšæœºæ—¶é—´ï¼Œä¾‹å¦‚ï¼š
- å‘¨ä¸€: ä¸Šç­ 06:51, ä¸‹ç­ 17:31
- å‘¨äºŒ: ä¸Šç­ 06:04, ä¸‹ç­ 17:56
- å‘¨ä¸‰: ä¸Šç­ 06:56, ä¸‹ç­ 17:32

## ğŸ“ˆ æ‰“å¡è®°å½•

æ‰€æœ‰æ‰“å¡ç»“æœä¿å­˜åœ¨ `punch_records.json` ä¸­ï¼ŒåŒ…å«ï¼š

```json
{
  "timestamp": "2025-07-03T01:30:06.145447",
  "user": "å¼ å¿—è¿œ",
  "type": "off",
  "time": "2025-07-03 01:30:06",
  "message": "æ‰“å¡æˆåŠŸï¼"
}
```

## ğŸ”§ ç®¡ç†å‘½ä»¤

```bash
# æœåŠ¡çŠ¶æ€
systemctl status checkin

# é‡å¯æœåŠ¡
systemctl restart checkin

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
journalctl -u checkin -f

# æŸ¥çœ‹æœ€è¿‘100æ¡æ‰“å¡è®°å½•
tail -100 punch_records.json
```

## ğŸ¯ æ¶æ„ä¼˜åŠ¿

### ä»£ç å¯¹æ¯”

- **åŸç‰ˆæœ¬**: 820è¡Œï¼ˆå†—ä½™åŠŸèƒ½å¤šï¼‰
- **æ–°ç‰ˆæœ¬**: 307è¡Œï¼ˆå‡å°‘62%ï¼‰

### ç§»é™¤å†—ä½™åŠŸèƒ½

âŒ å¥åº·æ£€æŸ¥HTTPæœåŠ¡å™¨  
âŒ å¤æ‚èŠ‚å‡æ—¥APIæ£€æµ‹  
âŒ é€šçŸ¥ç³»ç»Ÿ  
âŒ ä¿¡å·å¤„ç†å™¨  
âŒ å¤æ‚é”™è¯¯é‡è¯•æœºåˆ¶  
âŒ è¯¦ç»†æ—¥å¿—è½®è½¬  

### ä¿ç•™æ ¸å¿ƒåŠŸèƒ½

âœ… ç”¨æˆ·è®¤è¯ç™»å½•  
âœ… å¤šç”¨æˆ·ç®¡ç†  
âœ… æ‰“å¡åŠŸèƒ½ï¼ˆä¸Šç­/ä¸‹ç­ï¼‰  
âœ… å®šæ—¶è°ƒåº¦ï¼ˆå·¥ä½œæ—¥ï¼‰  
âœ… åŸºæœ¬é…ç½®ç®¡ç†  
âœ… æ‰“å¡è®°å½•ä¿å­˜  

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡é—®é¢˜è¯·æ£€æŸ¥ï¼š
1. é…ç½®æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®
2. ç”¨æˆ·åå¯†ç æ˜¯å¦æœ‰æ•ˆ
3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
4. æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨

---

**ğŸ‰ æç®€æ¶æ„ï¼Œé«˜æ•ˆè¿è¡Œï¼** 